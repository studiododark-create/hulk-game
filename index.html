<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hulk: The Game - Test Edition</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Arial', sans-serif; background: #000; }
        canvas { display: block; }

        /* Menu de Dificuldade */
        #menu {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 10;
        }
        #logo { width: 300px; margin-bottom: 20px; }
        .btn {
            background: #4CAF50; color: white; border: none; padding: 15px 40px;
            margin: 10px; font-size: 20px; cursor: pointer; border-radius: 5px;
            transition: 0.3s; width: 250px;
        }
        .btn:hover { background: #45a049; transform: scale(1.05); }
        
        #game-ui {
            position: absolute; top: 10px; left: 10px; color: white; 
            display: none; pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="menu">
        <img src="logo.png" id="logo" alt="Hulk Logo">
        <button class="btn" onclick="startGame('easy')">Fácil (Ross calmo)</button>
        <button class="btn" onclick="startGame('normal')">Normal (Hulk Vermelho)</button>
        <button class="btn" onclick="startGame('hard')">Difícil (Ross Furioso)</button>
    </div>

    <div id="game-ui">
        <h2>Hulk vs Red Hulk</h2>
        <p>Use WASD para mover | Barra de Espaço para Pular | E para Soco</p>
    </div>

    <script type="module">
        import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';
        import { FBXLoader } from 'https://cdn.skypack.dev/three@0.136.0/examples/jsm/loaders/FBXLoader.js';
        import { ColladaLoader } from 'https://cdn.skypack.dev/three@0.136.0/examples/jsm/loaders/ColladaLoader.js';

        let scene, camera, renderer, clock, mixer, city, hulk, redHulk;
        let animations = {};
        const baseUrl = "https://raw.githubusercontent.com/studiododark-create/hulk/main/modelos%20hulk%20the%20game/";

        // Áudios
        const themeMusic = new Audio('theme.mp3');
        const roarSound = new Audio(baseUrl + 'roar.mp3'); // Se você tiver um roar.mp3 no github

        window.startGame = function(difficulty) {
            document.getElementById('menu').style.display = 'none';
            document.getElementById('game-ui').style.display = 'block';
            themeMusic.loop = true;
            themeMusic.play();
            init();
            animate();
        }

        function init() {
            scene = new THREE.Scene();
            clock = new THREE.Clock();
            
            // Câmera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 5000);
            camera.position.set(0, 5, 15);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.body.appendChild(renderer.domElement);

            // Luzes
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            const sunLight = new THREE.DirectionalLight(0xffffff, 1);
            sunLight.position.set(50, 100, 50);
            scene.add(sunLight);

            // 1. Carregar a Cidade (.dae)
            const colladaLoader = new ColladaLoader();
            colladaLoader.load(baseUrl + 'model.dae', (collada) => {
                city = collada.scene;
                city.scale.set(1, 1, 1);
                scene.add(city);
            });

            // 2. Carregar Hulk e Animações (.fbx)
            const fbxLoader = new FBXLoader();
            
            // Carregamos o modelo base com a textura original
            fbxLoader.load(baseUrl + 'Idle.fbx', (object) => {
                hulk = object;
                hulk.scale.set(0.01, 0.01, 0.01);
                hulk.position.set(0, 0, 0);

                // Aplicar Textura
                const textureLoader = new THREE.TextureLoader();
                const hulkTexture = textureLoader.load(baseUrl + 'hulk_texture.png');
                hulk.traverse(child => {
                    if (child.isMesh) child.material.map = hulkTexture;
                });

                mixer = new THREE.AnimationMixer(hulk);
                
                // Carregar as outras animações
                const anims = ['Walking', 'Fast Run', 'Jumping', 'Punching ', 'Death', 'Pain Gesture'];
                anims.forEach(name => {
                    fbxLoader.load(baseUrl + name + '.fbx', (anim) => {
                        animations[name] = mixer.clipAction(anim.animations[0]);
                        if(name === 'Idle') animations[name].play();
                    });
                });

                scene.add(hulk);

                // Grito do Hulk ao iniciar
                console.log("HULK SMASH!");
                // Se quiser tocar o áudio dele falando:
                // roarSound.play();

                // 3. Criar Red Hulk (Clone do Hulk)
                createRedHulk(textureLoader);
            });
        }

        function createRedHulk(loader) {
            // Criamos o inimigo clonando o modelo do Hulk
            fbxLoader.load(baseUrl + 'Idle.fbx', (object) => {
                redHulk = object;
                redHulk.scale.set(0.01, 0.01, 0.01);
                redHulk.position.set(10, 0, -10); // Spawna um pouco longe

                const redTexture = loader.load(baseUrl + 'red_hulk_texture.png');
                redHulk.traverse(child => {
                    if (child.isMesh) child.material.map = redTexture;
                });

                scene.add(redHulk);
            });
        }

        function animate() {
            requestAnimationFrame(animate);
            const delta = clock.getDelta();
            if (mixer) mixer.update(delta);
            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>